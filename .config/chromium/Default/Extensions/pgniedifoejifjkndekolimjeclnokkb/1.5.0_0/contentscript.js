(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
const FORBIDDEN_DOMAINS=["chrome.google.com"];var tabListener=null;function isBackgroundScript(){return new Promise(function(e,n){chrome.extension.getBackgroundPage()===window?e():n()})}function addOnMessageCallback(e){chrome.runtime.onMessage.removeListener(e),chrome.runtime.onMessage.addListener(e)}function removeOnMessageCallback(e){chrome.runtime.onMessage.removeListener(e)}function sendMessageToTab(e,n,t){chrome.tabs.sendMessage(e.id,n,t)}function sendMessageToBackground(e,n){chrome.runtime.sendMessage(e,n)}function loadStorage(e){return new Promise(function(n,t){chrome.storage[e].get(null,function(e){chrome.runtime.lastError&&t(chrome.runtime.lastError.message),n(e)})})}function saveStorage(e,n){return new Promise(function(t,o){chrome.storage[n].set(e,function(){chrome.runtime.lastError?o(chrome.runtime.lastError.message):t()})})}function injectScriptToTab(e,n,t){return new Promise(function(o,r){chrome.tabs.executeScript(n.id,{file:e,runAt:!0===t?"document_idle":"document_start",allFrames:t},function(){chrome.runtime.lastError?r(chrome.runtime.lastError):o()})})}function listenForTabs(e){null!==tabListener&&chrome.tabs.onUpdated.removeListener(tabListener),tabListener=function(n,t,o){"complete"===t.status&&e(o)},chrome.tabs.onUpdated.addListener(tabListener)}function getActiveTab(){return new Promise(function(e,n){chrome.tabs.query({active:!0,lastFocusedWindow:!0},function(t){0===t.length?n():e(t[0])})})}function reloadTab(e){return new Promise(function(n){chrome.tabs.reload(e.id,n)})}function openOptionsPage(){chrome.runtime.openOptionsPage()}function setBadgeText(e,n,t){var o=n.length>4?"âˆž":n;chrome.browserAction.setBadgeBackgroundColor({color:t,tabId:e.id}),chrome.browserAction.setBadgeText({text:o,tabId:e.id})}function getURL(e){return chrome.extension.getURL(e)}module.exports={isBackgroundScript:isBackgroundScript,addOnMessageCallback:addOnMessageCallback,removeOnMessageCallback:removeOnMessageCallback,sendMessageToTab:sendMessageToTab,sendMessageToBackground:sendMessageToBackground,getURL:getURL,loadStorage:loadStorage,saveStorage:saveStorage,injectScriptToTab:injectScriptToTab,listenForTabs:listenForTabs,getActiveTab:getActiveTab,reloadTab:reloadTab,openOptionsPage:openOptionsPage,setBadgeText:setBadgeText,forbiddenDomains:FORBIDDEN_DOMAINS};

},{}],2:[function(require,module,exports){
var client,MessageClient=require("messageClient"),emoteParser=require("./emoteParser"),tipsy=require("./tipsy");function initialize(){window.contentScriptInjected||(window.contentScriptInjected=!0,(client=new MessageClient).listen(onMessageFromBackground),emoteParser.run(client))}function onMessageFromBackground(e,t){e&&("settings"===e.header?(!0===e.payload.twitchStyleTooltips&&tipsy.init(),!0===e.payload.replaceYouTubeKappa&&emoteParser.replaceKappers()):emoteParser.onBackgroundMessage(e),t&&t())}initialize();

},{"./emoteParser":3,"./tipsy":5,"messageClient":6}],3:[function(require,module,exports){
var pageObserver=require("./pageObserver");const MAX_EMOTE_PARSES_PER_ITERATION=20,COUNTER_UPDATE_COOLDOWN=2e3,EMOTE_CSS="display:inline !important;height:auto !important;width:auto !important;max-height:100% !important;max-width:auto !important;opacity:1 !important;outline:0 !important;border:0 !important;margin:0 !important;padding:0 !important;z-index:auto !important;visibility:visible !important;",TIPSY_DATA_ATTRIBUTE="gte-tipsy-text",KAPPER_SHARED_TOOLTIP_TEXT=":full_moon_with_face:",KAPPA_IMAGE_URL="https://static-cdn.jtvnw.net/emoticons/v1/25/1.0";var counterUpdateCallback,messageClient,emoteCount=0,startNodeID=0,pendingIDToNodesMapping=new Map,pendingNodesToIDsMapping=new Map,pendingEmoteParses=[];function runParser(e){messageClient=e,setInterval(applyEmoteSearchResults,0),pageObserver.onIframeFound(notifyBackgroundOnNewIframe),pageObserver.observe(extractAndSendText)}function isInIframe(){try{return window.self!==window.top}catch(e){return!0}}function notifyBackgroundOnNewIframe(){messageClient.messageBackground({header:"iframeFound",payload:null})}function replaceKappers(){pageObserver.onImageFound(replaceKapperWithKappa)}function replaceKapperWithKappa(e){if(/youtube.com/i.test(window.location.hostname)&&e.getAttribute("shared-tooltip-text")===KAPPER_SHARED_TOOLTIP_TEXT){e.setAttribute("class","GTEEmote"),e.setAttribute("src",KAPPA_IMAGE_URL),e.setAttribute("title","Kapper"),e.setAttribute(TIPSY_DATA_ATTRIBUTE,generateTipsyAlt("Kapper","")),e.setAttribute("alt","Kapper"),e.style.cssText=EMOTE_CSS}}function onBackgroundMessage(e){"emoteSearchResults"===e.header&&processEmoteSearchResults(e.payload.id,e.payload.foundEmotes)}function extractAndSendText(e){var t=e.nodeValue,n=startNodeID++;pendingIDToNodesMapping.set(n,e),pendingNodesToIDsMapping.set(e,n),messageClient.messageBackground({header:"searchTextForEmotes",payload:{id:n,hostname:window.location.hostname.toLowerCase(),text:t}})}function processEmoteSearchResults(e,t){var n=pendingIDToNodesMapping.get(e),o=pendingNodesToIDsMapping.get(n)===e;t.length>0&&!0===o&&pendingEmoteParses.push({node:n,processedIndex:0,lastIndex:0,lastLength:0,foundEmotes:t}),pendingIDToNodesMapping.delete(e)}function applyEmoteSearchResults(){var e=0;e:for(var t=pendingEmoteParses.length-1;t>=0;--t){for(var n=pendingEmoteParses[t],o=n.processedIndex;o<n.foundEmotes.length;++o){if(e===MAX_EMOTE_PARSES_PER_ITERATION)break e;var a=n.foundEmotes[o].index;a-=n.lastIndex+n.lastLength,n.lastIndex=n.foundEmotes[o].index,n.lastLength=n.foundEmotes[o].emote.length;try{n.node=parseEmoteString(n.node,a,n.foundEmotes[o].emote,n.foundEmotes[o].channel,n.foundEmotes[o].url,n.foundEmotes[o].emoji)}catch(e){}finally{n.processedIndex++,e++}}pendingNodesToIDsMapping.delete(n.node),pendingEmoteParses.splice(t,1)}}function parseEmoteString(e,t,n,o,a,r){var s,i=e.parentNode,d=e.nodeValue,p=null;if(null!==i)return s=a?createEmoteImage(n,o,a):createUnicodeEmoji(n,o,r),e.isGTENode=!0,i.insertBefore(s,e.nextSibling),t+n.length<d.length&&((p=document.createTextNode(d.substring(t+n.length))).isGTENode=!0,i.insertBefore(p,s.nextSibling)),0===t?i.removeChild(e):e.nodeValue=d.substring(0,t),onNewEmote(),p}function createEmoteImage(e,t,n){var o=document.createElement("img");return o.setAttribute("class","GTEEmote"),o.setAttribute("src",n),o.setAttribute("title",e),o.setAttribute(TIPSY_DATA_ATTRIBUTE,generateTipsyAlt(e,t)),o.setAttribute("alt",e),o.style.cssText=EMOTE_CSS,o}function generateTipsyAlt(e,t){return"FrankerFaceZ Emote"===t||"BetterTTV Emote"===t||"Custom GTE Emote"===t?"Emote: "+e+"\n"+t:""!==t?"Emote: "+e+"\nChannel: "+t:e}function createUnicodeEmoji(e,t,n){var o=document.createElement("div");return o.setAttribute("class","GTEEmote"),o.setAttribute("title",e),o.setAttribute(TIPSY_DATA_ATTRIBUTE,generateTipsyAlt(e,t)),o.setAttribute("alt",e),o.style.cssText=EMOTE_CSS,o.innerText=n,o}function onNewEmote(){emoteCount++,clearTimeout(counterUpdateCallback),counterUpdateCallback=setTimeout(updateCounter,COUNTER_UPDATE_COOLDOWN)}function updateCounter(){!1===isInIframe()&&messageClient.messageBackground({header:"setBadgeText",payload:emoteCount})}module.exports={run:runParser,onBackgroundMessage:onBackgroundMessage,replaceKappers:replaceKappers};

},{"./pageObserver":4}],4:[function(require,module,exports){
const PAGE_OBSERVER_PARAMETERS={attributes:!1,characterData:!0,childList:!0,subtree:!0},TREE_WALKER_FILTER={acceptNode:treeWalkerFilterFunction},ILLEGAL_TAGNAMES=["IMG","NOSCRIPT","SCRIPT","STYLE","TEXTAREA"],CURRENT_HOSTNAME=window.location.hostname.toLowerCase(),MAX_TREE_WALKER_RUNS_PER_ITERATION=5,MAX_NODES_PER_ITERATION=1;var mutationObserver,nodeCallback,iframeFoundCallback,imageFoundCallback,iterateTreeWalkersCallback,iterateNodesCallback,treeWalkers=[],mutatedNodes=[],pendingImages=[],iframeFound=!1,currentlyIteratingThroughTreeWalkers=!1,currentlyIteratingThroughNodes=!1;function startMutationObserver(e){mutationObserver=new MutationObserver(onPageChange),nodeCallback=e,mutationObserver.observe(document.body,PAGE_OBSERVER_PARAMETERS),addMutatedNode(document.body)}function onPageChange(e){for(var a=0;a<e.length;++a){var t=e[a];if("characterData"===t.type)addMutatedNode(t.target);else if("childList"===t.type)for(var r=0;r<t.addedNodes.length;++r){var o=t.addedNodes.item(r);addMutatedNode(o),"IMG"===o.tagName&&imageDetected(o)}}}function addMutatedNode(e){!1===isIllegalNode(e)&&mutatedNodes.push(e),clearTimeout(iterateNodesCallback),iterateNodesCallback=setTimeout(iterateThroughPendingNodes,0)}function iterateThroughPendingNodes(){if(!1===currentlyIteratingThroughNodes){currentlyIteratingThroughNodes=!0;for(var e=0;mutatedNodes.length>0&&e!==MAX_NODES_PER_ITERATION;){var a=mutatedNodes.shift();a.nodeType===Node.TEXT_NODE?nodeCallback(a):a.nodeType===Node.ELEMENT_NODE&&addTreeWalker(a),e++}currentlyIteratingThroughNodes=!1,mutatedNodes.length>0&&(clearTimeout(iterateNodesCallback),iterateNodesCallback=setTimeout(iterateThroughPendingNodes,0))}}function addTreeWalker(e){treeWalkers.push(document.createTreeWalker(e,NodeFilter.SHOW_TEXT+NodeFilter.SHOW_ELEMENT,TREE_WALKER_FILTER,!1)),clearTimeout(iterateTreeWalkersCallback),iterateTreeWalkersCallback=setTimeout(runTreeWalker,0)}function runTreeWalker(){if(!1===currentlyIteratingThroughTreeWalkers){currentlyIteratingThroughTreeWalkers=!0;var e=0;e:for(;treeWalkers.length>0;){for(var a,t=treeWalkers[0];a=t.nextNode();)if(addMutatedNode(a),++e===MAX_TREE_WALKER_RUNS_PER_ITERATION)break e;treeWalkers.shift()}currentlyIteratingThroughTreeWalkers=!1,treeWalkers.length>0&&(clearTimeout(iterateTreeWalkersCallback),iterateTreeWalkersCallback=setTimeout(runTreeWalker,0))}}function treeWalkerFilterFunction(e){var a=NodeFilter.FILTER_SKIP;return e.nodeType===Node.TEXT_NODE?a=NodeFilter.FILTER_ACCEPT:e.nodeType===Node.ELEMENT_NODE&&"IFRAME"===e.tagName&&iframeDetected(),a}function iframeDetected(){iframeFoundCallback&&(iframeFoundCallback(),iframeFoundCallback=null),iframeFound=!0}function onIframeFound(e){!0===iframeFound?e():iframeFoundCallback=e}function imageDetected(e){imageFoundCallback?imageFoundCallback(e):pendingImages.push(e)}function onImageFound(e){imageFoundCallback=e;for(var a=0;a<pendingImages.length;++a)imageFoundCallback(e);pendingImages=[]}function isIllegalNode(e){var a=!0;if(e&&(e.nodeType===Node.TEXT_NODE||e.nodeType===Node.ELEMENT_NODE)){var t=e.nodeType===Node.TEXT_NODE?e.parentNode:e;a=!1,e.nodeType!==Node.TEXT_NODE||t?-1!==ILLEGAL_TAGNAMES.indexOf(t.tagName)?a=!0:-1!==t.classList.value.indexOf("GTETipsy")||-1!==CURRENT_HOSTNAME.indexOf("twitch.tv")&&-1!==t.classList.value.indexOf("tooltip")?a=!0:t.isContentEditable?a=!0:0===e.textContent.replace(/\s/g,"").length?a=!0:!0===e.hasOwnProperty("isGTENode")&&(a=!0):a=!0}return a}module.exports={observe:startMutationObserver,onIframeFound:onIframeFound,onImageFound:onImageFound};

},{}],5:[function(require,module,exports){
var pageObserver=require("./pageObserver");const OUTER_TIPSY_CSS="display:block !important;position:absolute !important;opacity:1 !important;z-index:9999999 !important;visibility:visible !important;word-break:break-all !important;padding:5px !important;box-sizing:border-box !important;",INNER_TIPSY_CSS="display:block !important;position:static !important;background:rgba(0,0,0,0.8) !important;visibility:visible !important;font-size:12px !important;line-height:16px !important;font-family:Arial !important;color:#FFFFFF !important;max-width:200px !important;padding:5px 8px 4px !important;text-align:center !important;white-space:pre !important;",ARROW_TIPSY_CSS="display:block !important;position:absolute !important;width:0 !important;height:0 !important;border:5px solid transparent !important;right:10px !important;opacity: 0.8 !important;background-color:rgba(0,0,0,0) !important;box-sizing:border-box !important;",SOUTH_TIPSY_ARROW_CSS=ARROW_TIPSY_CSS+"top:0 !important;border-top:none !important;border-bottom-color:#000000 !important;",NORTH_TIPSY_ARROW_CSS=ARROW_TIPSY_CSS+"bottom:0 !important;border-bottom:none !important;border-top-color:#000000 !important;",TIPSY_DATA_ATTRIBUTE="gte-tipsy-text";var tipsyVisible=!1,tipsy=null;function init(){null===tipsy&&(document.body.addEventListener("mouseover",mouseoverEventHandler),createTipsy())}function mouseoverEventHandler(t){"GTEEmote"===t.target.className?showTipsy(t.target):hideTipsy()}function createTipsy(){(tipsy={}).outer=document.createElement("div"),tipsy.outer.className="GTETipsy",tipsy.outer.style.cssText=OUTER_TIPSY_CSS,tipsy.inner=document.createElement("div"),tipsy.inner.className="GTETipsyInner",tipsy.inner.style.cssText=INNER_TIPSY_CSS,tipsy.arrow=document.createElement("div"),tipsy.arrow.className="GTETipsyArrow",tipsy.outer.appendChild(tipsy.inner),tipsy.outer.appendChild(tipsy.arrow),tipsy.containingDocument=null}function showTipsy(t){tipsyVisible=!0,""!==t.title&&t.removeAttribute("title"),tipsy.inner.textContent=t.getAttribute(TIPSY_DATA_ATTRIBUTE)||"null",tipsy.containingDocument=t.ownerDocument.body,tipsy.containingDocument.appendChild(tipsy.outer),positionTipsy(t)}function hideTipsy(){!0===tipsyVisible&&(tipsyVisible=!1,tipsy.containingDocument.removeChild(tipsy.outer))}function positionTipsy(t){var i=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft,e=tipsy.outer.offsetWidth,n=tipsy.outer.offsetHeight,r={top:t.getBoundingClientRect().top+i,left:t.getBoundingClientRect().left+o},p=r.top,s=r.left,a=t.offsetHeight,l=t.offsetWidth;!1===r.top-n<i?(tipsy.outer.style.top=p-n+"px",tipsy.arrow.style.cssText=NORTH_TIPSY_ARROW_CSS):(tipsy.outer.style.top=p+a+"px",tipsy.arrow.style.cssText=SOUTH_TIPSY_ARROW_CSS),tipsy.outer.style.left=s+l/2-e+15+"px"}module.exports={init:init};

},{"./pageObserver":4}],6:[function(require,module,exports){
var browser=require("browser");function MessageClient(){var e=null;function s(s){e&&e(s)}function n(s,n,r){return e&&e(s,r,n.tab),!0}this.listen=function(s){e=s,browser.addOnMessageCallback(n)},this.stopListening=function(){e=null,browser.removeOnMessageCallback(n)},this.messageTab=function(e,n){browser.sendMessageToTab(e,n,s)},this.messageBackground=function(e){browser.sendMessageToBackground(e,s)}}module.exports=MessageClient;

},{"browser":1}]},{},[2]);
